---
import SocialShareButtons from './SocialShareButtons.astro';
import { Icon } from 'astro-icon/components';

const currentYear = new Date().getFullYear();
---

<footer class="bg-white dark:bg-zinc-950 border-t-3 border-black pt-16 pb-8 relative overflow-hidden">
  <!-- Wild asymmetric decorative elements -->
  <div class="absolute top-0 left-0 w-48 h-40 bg-neo-purple border-r-6 border-b-6 border-black rotate-6"></div>
  <div class="absolute bottom-0 right-0 w-40 h-56 bg-neo-orange border-l-6 border-t-6 border-black -rotate-6"></div>
  <div class="absolute top-1/2 left-1/3 w-32 h-32 bg-neo-yellow border-3 border-black rotate-45"></div>
  <div class="absolute top-1/4 right-1/4 w-24 h-48 bg-neo-pink border-6 border-black -rotate-12"></div>
  
  <div class="container mx-auto px-4 relative z-10">
    <div class="grid md:grid-cols-2 gap-12 mb-12">
      <!-- Left side - Info -->
      <div class="space-y-6 animate-on-scroll slide-right">
        <div class="brutal-card bg-white dark:bg-zinc-900 -rotate-1 hover:rotate-0 transition-all">
          <div class="p-6">
            <h2 class="text-4xl font-bold uppercase mb-2 tracking-tight">Ethan Cornwill</h2>
            <p class="text-xl font-bold">Technical Lead & AI Developer</p>
          </div>
        </div>
        
        <div class="brutal-card bg-neo-blue rotate-1 hover:rotate-0 transition-all">
          <div class="p-6">
            <p class="font-bold uppercase mb-2">Quick Links</p>
            <div class="flex flex-wrap gap-3">
              <a href="#aboutme" class="brutal-btn brutal-yellow px-4 py-2 text-sm rotate-2 hover:rotate-0">About</a>
              <a href="#projects" class="brutal-btn brutal-pink px-4 py-2 text-sm -rotate-2 hover:rotate-0">Projects</a>
              <a href="#skills" class="brutal-btn brutal-green px-4 py-2 text-sm rotate-1 hover:rotate-0">Skills</a>
              <a href="#contact" class="brutal-btn brutal-purple px-4 py-2 text-sm -rotate-1 hover:rotate-0">Contact</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Right side - Social & Share -->
      <div class="space-y-6 animate-on-scroll slide-left">
        <div class="brutal-card bg-white dark:bg-zinc-900 rotate-2 hover:rotate-0 transition-all">
          <div class="p-6">
            <p class="font-bold uppercase mb-4">Connect With Me</p>
            <div class="flex flex-wrap gap-3">
              <a 
                href="https://github.com/finneh4249" 
                target="_blank" 
                rel="noopener noreferrer"
                class="brutal-btn bg-black text-white w-20 h-20 p-0 flex items-center justify-center rotate-6 hover:rotate-0 transition-all"
                aria-label="GitHub Profile"
              >
                <Icon name="mdi:github" class="text-5xl" />
              </a>
              <a 
                href="https://linkedin.com/in/ethancornwill" 
                target="_blank" 
                rel="noopener noreferrer"
                class="brutal-btn bg-[#0077B5] text-white w-20 h-20 p-0 flex items-center justify-center -rotate-6 hover:rotate-0 transition-all"
                aria-label="LinkedIn Profile"
              >
                <Icon name="mdi:linkedin" class="text-5xl" />
              </a>
              <a 
                href="https://twitter.com/melbPAT" 
                target="_blank" 
                rel="noopener noreferrer"
                class="brutal-btn brutal-blue w-20 h-20 p-0 flex items-center justify-center rotate-3 hover:rotate-0 transition-all"
                aria-label="Twitter Profile"
              >
                <Icon name="mdi:twitter" class="text-5xl" />
              </a>
              <button
                id="footer-share-btn"
                class="brutal-btn brutal-yellow w-20 h-20 p-0 flex items-center justify-center -rotate-3 hover:rotate-0 transition-all"
                aria-label="Share this portfolio"
              >
                <Icon name="mdi:share-variant" class="text-5xl" />
              </button>
            </div>
          </div>
        </div>
        
        <button
          id="footer-share-btn-large"
          class="brutal-btn brutal-pink px-8 py-4 text-lg w-full -rotate-1 hover:rotate-0 transition-all"
        >
          <span class="font-bold uppercase">Share My Portfolio</span>
        </button>
      </div>
    </div>
    
    <div class="border-t-brutal border-black pt-6 mt-6">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div 
          id="copyright-btn"
          class="brutal-btn bg-white dark:bg-zinc-900 px-6 py-3 rotate-1 cursor-pointer relative hover:scale-105 hover:rotate-0 active:scale-95 transition-all"
        >
          <p class="font-bold">&copy; {currentYear} Ethan Cornwill. Built with Astro + React.</p>
          <div id="secret-message" class="absolute -top-12 left-1/2 transform -translate-x-1/2 brutal-btn brutal-yellow px-4 py-2 text-sm whitespace-nowrap opacity-0 transition-opacity">
            <!-- Message injected by JS -->
          </div>
        </div>
        <div class="flex gap-3 font-bold">
          <a 
            href="mailto:mail@finneh.xyz" 
            class="brutal-btn brutal-yellow px-4 py-2 -rotate-1 hover:rotate-0 transition-all text-sm"
          >
            mail@finneh.xyz
          </a>
          <a 
            href="https://github.com/finneh4249" 
            target="_blank" 
            rel="noopener noreferrer"
            class="brutal-btn bg-white dark:bg-zinc-900 px-4 py-2 rotate-1 hover:rotate-0 transition-all text-sm"
          >
            View Source
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Share Dialog (Hidden by default) -->
  <div id="share-dialog" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 hidden">
    <div class="bg-white dark:bg-zinc-900 rounded-none border-3 border-black p-6 max-w-md w-full shadow-brutal-xl relative">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-black dark:text-white">Share My Portfolio</h3>
        <button id="close-share-dialog" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
          <Icon name="mdi:close" class="text-2xl" />
        </button>
      </div>
      
      <p class="text-gray-600 dark:text-gray-300 mb-4">If you like my work, please share my portfolio with others!</p>
      
      <SocialShareButtons showText={true} className="mb-4" />
      
      <div class="mt-4 pt-4 border-t-3 border-black">
        <div class="relative">
          <input
            type="text"
            id="share-url-input"
            readonly
            class="w-full bg-gray-100 dark:bg-zinc-800 border-3 border-black rounded-none py-2 px-4 pr-12 text-black dark:text-white text-sm focus:shadow-brutal-sm focus:outline-none transition-all"
          />
          <button
            id="dialog-copy-btn"
            class="absolute right-2 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300"
          >
            <Icon name="mdi:content-copy" />
          </button>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
  function initFooter() {
    const shareDialog = document.getElementById('share-dialog');
    const openBtns = [document.getElementById('footer-share-btn'), document.getElementById('footer-share-btn-large')];
    const closeBtn = document.getElementById('close-share-dialog');
    const copyrightBtn = document.getElementById('copyright-btn');
    const secretMsg = document.getElementById('secret-message');
    const urlInput = document.getElementById('share-url-input') as HTMLInputElement | null;
    const dialogCopyBtn = document.getElementById('dialog-copy-btn');
    
    // Set URL input value
    if (urlInput) urlInput.value = window.location.href;

    // Share Dialog Logic
    const toggleDialog = (show) => {
      if (show) {
        shareDialog?.classList.remove('hidden');
      } else {
        shareDialog?.classList.add('hidden');
      }
    };

    openBtns.forEach(btn => btn?.addEventListener('click', () => toggleDialog(true)));
    closeBtn?.addEventListener('click', () => toggleDialog(false));
    shareDialog?.addEventListener('click', (e) => {
      if (e.target === shareDialog) toggleDialog(false);
    });

    // Dialog Copy Button
    if (dialogCopyBtn && urlInput) {
      dialogCopyBtn.addEventListener('click', () => {
        urlInput.select();
        navigator.clipboard.writeText(urlInput.value);
        // Visual feedback could be added here
      });
    }

    // Easter Egg Logic
    let clickCount = 0;
    if (copyrightBtn && secretMsg) {
      copyrightBtn.addEventListener('click', () => {
        clickCount++;
        
        const messages = [
          '',
          'ðŸ‘€ Hmm?',
          'ðŸ¤” What are you doing?',
          'ðŸŽ¯ Keep clicking...',
          'ðŸš€ Almost there...',
          'ðŸŽ‰ You did it! ðŸŽŠ',
        ];
        
        let msgText = '';
        if (clickCount < messages.length) {
          msgText = messages[clickCount];
        } else if (clickCount === 5) {
          setTimeout(() => msgText = 'âœ¨ Secret Unlocked! âœ¨', 100);
          setTimeout(() => msgText = 'ðŸ“¦ Repo: github.com/finneh4249/finnehxyz', 2000);
        } else if (clickCount > 10) {
          const funnyMessages = ['ðŸ›‘ Stop', 'ðŸ˜… Nothing more', 'âš¡ You win', 'ðŸ† Click Champion'];
          msgText = funnyMessages[Math.min(clickCount - 11, funnyMessages.length - 1)] || '...';
        }
        
        if (msgText) {
          secretMsg.textContent = msgText;
          secretMsg.classList.remove('opacity-0');
          secretMsg.style.transform = 'translate(-50%, -10px)';
          setTimeout(() => {
             secretMsg.classList.add('opacity-0');
             secretMsg.style.transform = 'translate(-50%, 0)';
          }, 2000);
        }
      });
    }

    // Simple Scroll Animation
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-fadeIn');
          (entry.target as HTMLElement).style.opacity = '1';
          (entry.target as HTMLElement).style.transform = 'translateX(0)';
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.animate-on-scroll').forEach(el => {
      const element = el as HTMLElement;
      element.style.opacity = '0';
      element.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
      if (element.classList.contains('slide-right')) element.style.transform = 'translateX(-50px)';
      if (element.classList.contains('slide-left')) element.style.transform = 'translateX(50px)';
      observer.observe(element);
    });
  }

  initFooter();
  document.addEventListener('astro:page-load', initFooter);
</script>