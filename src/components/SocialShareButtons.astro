---
interface Props {
  title?: string;
  description?: string;
  url?: string;
  className?: string;
  showText?: boolean;
  compact?: boolean;
}

import { Icon } from 'astro-icon/components';

const { 
  title, 
  description = "Check out this awesome portfolio!", 
  url, 
  className = '', 
  showText = false, 
  compact = false 
} = Astro.props;

const platforms = [
  {
    id: 'twitter',
    name: 'Twitter',
    icon: 'mdi:twitter',
    color: 'bg-blue-400 hover:bg-blue-500 text-white',
    ariaLabel: 'Share on Twitter'
  },
  {
    id: 'linkedin',
    name: 'LinkedIn',
    icon: 'mdi:linkedin',
    color: 'bg-blue-700 hover:bg-blue-800 text-white',
    ariaLabel: 'Share on LinkedIn'
  },
  {
    id: 'facebook',
    name: 'Facebook',
    icon: 'mdi:facebook',
    color: 'bg-blue-600 hover:bg-blue-700 text-white',
    ariaLabel: 'Share on Facebook'
  },
  {
    id: 'reddit',
    name: 'Reddit',
    icon: 'mdi:reddit',
    color: 'bg-orange-600 hover:bg-orange-700 text-white',
    ariaLabel: 'Share on Reddit'
  },
  {
    id: 'email',
    name: 'Email',
    icon: 'mdi:email',
    color: 'bg-gray-500 hover:bg-gray-600 text-white',
    ariaLabel: 'Share via Email'
  }
];

const buttonBaseClass = compact
  ? 'w-8 h-8 rounded-none flex items-center justify-center text-lg transition-transform hover:scale-110 focus:outline-none focus:ring-2'
  : 'flex items-center justify-center rounded-none px-3 py-2 transition-colors hover:shadow-md focus:outline-none focus:ring-2';
---

<div class:list={["social-share-buttons", className]}>
  <div class="flex flex-wrap gap-2 items-center">
    <!-- Share platform buttons -->
    {platforms.map((platform) => (
      <button
        data-platform={platform.id}
        class:list={[buttonBaseClass, platform.color, "share-btn"]}
        aria-label={platform.ariaLabel}
        data-title={title}
        data-description={description}
        data-url={url}
      >
        <Icon name={platform.icon} />
        {showText && !compact && (
          <span class="ml-2">{platform.name}</span>
        )}
      </button>
    ))}
    
    <!-- Copy link button -->
    <button
      id="copy-link-btn"
      class:list={[buttonBaseClass, "bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-white"]}
      aria-label="Copy link to clipboard"
      data-url={url}
    >
      <Icon name="mdi:link-variant" class="copy-icon-link" />
      <Icon name="mdi:check" class="copy-icon-check hidden" />
      {showText && !compact && (
        <span class="ml-2 copy-text">Copy Link</span>
      )}
    </button>
  </div>
</div>

<script>
  function initShareButtons() {
    // Helper for event tracking (mock if Analytics not present)
    const trackEvent = (category, action, label) => {
      if (window.gtag) {
        window.gtag('event', action, {
          event_category: category,
          event_label: label
        });
      }
    };

    // Share handlers
    const handleShare = (platform, title, description, url) => {
      const shareTitle = title || document.title;
      const shareUrl = url || window.location.href;
      const shareDescription = description || "Check out this awesome portfolio!";
      
      trackEvent('Social', 'Share', platform);
      
      let shareLink;
      
      switch (platform) {
        case 'twitter':
          shareLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareTitle)}&url=${encodeURIComponent(shareUrl)}`;
          break;
        
        case 'linkedin':
          shareLink = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(shareUrl)}`;
          break;
          
        case 'facebook':
          shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
          break;
        
        case 'reddit':
          shareLink = `https://reddit.com/submit?url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent(shareTitle)}`;
          break;
          
        case 'email':
          shareLink = `mailto:?subject=${encodeURIComponent(shareTitle)}&body=${encodeURIComponent(shareDescription + '\n\n' + shareUrl)}`;
          break;
          
        default:
          return;
      }
      
      window.open(shareLink, '_blank', 'width=600,height=400');
    };

    // Attach listeners to share buttons
    document.querySelectorAll('.share-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const platform = btn.dataset.platform;
        const title = btn.dataset.title;
        const description = btn.dataset.description;
        const url = btn.dataset.url;
        handleShare(platform, title, description, url);
      });
    });

    // Copy Link Handler
    const copyBtn = document.getElementById('copy-link-btn');
    if (copyBtn) {
      copyBtn.addEventListener('click', () => {
        const url = copyBtn.dataset.url || window.location.href;
        
        navigator.clipboard.writeText(url).then(() => {
          const linkIcon = copyBtn.querySelector('.copy-icon-link');
          const checkIcon = copyBtn.querySelector('.copy-icon-check');
          const text = copyBtn.querySelector('.copy-text');
          
          // Visual feedback
          copyBtn.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'dark:bg-gray-700', 'dark:hover:bg-gray-600', 'text-gray-700', 'dark:text-white');
          copyBtn.classList.add('bg-green-500', 'hover:bg-green-600', 'text-white');
          
          if (linkIcon && checkIcon) {
            linkIcon.classList.add('hidden');
            checkIcon.classList.remove('hidden');
          }
          
          if (text) text.textContent = 'Copied!';
          
          trackEvent('Social', 'Share', 'CopyLink');
          
          // Reset after 2 seconds
          setTimeout(() => {
            copyBtn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'dark:bg-gray-700', 'dark:hover:bg-gray-600', 'text-gray-700', 'dark:text-white');
            copyBtn.classList.remove('bg-green-500', 'hover:bg-green-600', 'text-white');
            
            if (linkIcon && checkIcon) {
              linkIcon.classList.remove('hidden');
              checkIcon.classList.add('hidden');
            }
            
            if (text) text.textContent = 'Copy Link';
          }, 2000);
        });
      });
    }
  }

  initShareButtons();
  document.addEventListener('astro:page-load', initShareButtons);
</script>