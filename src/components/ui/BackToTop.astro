---
import { Icon } from 'astro-icon/components';

interface Props {
  threshold?: number;
  right?: number;
  bottom?: number;
}

const { threshold = 300, right = 6, bottom = 6 } = Astro.props;
---

<button
  id="back-to-top"
  class="fixed bg-neo-purple border-3 border-black dark:border-white text-black dark:text-white font-black uppercase p-4 z-50 opacity-0 scale-50 pointer-events-none transition-all duration-300 hover:scale-110 active:scale-90 shadow-brutal hover:shadow-brutal-lg transform rotate-3 hover:-rotate-3 rounded-none"
  style={{ right: `${right}px`, bottom: `${bottom}px` }}
  aria-label="Back to top"
>
  <Icon name="mdi:arrow-up" class="text-3xl" />
</button>

<style is:global>
  .shadow-brutal {
    box-shadow: 4px 4px 0px 0px rgba(0, 0, 0, 1);
  }

  .dark .shadow-brutal {
    box-shadow: 4px 4px 0px 0px rgba(255, 255, 255, 1);
  }

  .shadow-brutal-lg {
    box-shadow: 6px 6px 0px 0px rgba(0, 0, 0, 1);
  }

  .dark .shadow-brutal-lg {
    box-shadow: 6px 6px 0px 0px rgba(255, 255, 255, 1);
  }
</style>

<script define:vars={{ threshold }}>
  function initBackToTop() {
    const btn = document.getElementById('back-to-top');
    
    if (btn) {
      const handleScroll = () => {
        if (window.scrollY > threshold) {
          btn.classList.remove('opacity-0', 'scale-50', 'pointer-events-none');
          btn.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');
        } else {
          btn.classList.add('opacity-0', 'scale-50', 'pointer-events-none');
          btn.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
        }
      };

      const scrollToTop = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };

      window.addEventListener('scroll', handleScroll, { passive: true });
      btn.addEventListener('click', scrollToTop);
      
      handleScroll(); // Initial check
    }
  }

  initBackToTop();
  document.addEventListener('astro:page-load', initBackToTop);
</script>