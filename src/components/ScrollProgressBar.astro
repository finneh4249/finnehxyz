---
interface Props {
  className?: string;
  thickness?: string;
  orientation?: 'horizontal' | 'vertical';
}

const { className = '', thickness = '6px', orientation = 'horizontal' } = Astro.props;

const style = orientation === 'horizontal' ? { height: thickness, width: '100%' } : { width: thickness, height: '100%' };
---

<div class:list={["pointer-events-none z-50", className]} style={style}>
  <div 
    class:list={[
      "bg-neo-yellow border-black transition-transform duration-75 scroll-progress-bar",
      orientation === 'horizontal' ? "h-full border-b-brutal origin-left scale-x-0" : "w-full border-r-brutal origin-top scale-y-0"
    ]}
    role="progressbar"
    aria-valuenow="0"
    aria-valuemin="0"
    aria-valuemax="100"
    data-orientation={orientation}
  ></div>
</div>

<script>
  function initScrollProgress() {
    const progressBars = document.querySelectorAll('.scroll-progress-bar');
    if (progressBars.length === 0) return;

    const calculateScrollProgress = () => {
      requestAnimationFrame(() => {
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        
        if (scrollHeight > 0) {
          const scrollPercentage = (scrollTop / scrollHeight);
          
          progressBars.forEach(bar => {
            const el = bar as HTMLElement;
            const orientation = el.dataset.orientation;
            
            if (orientation === 'horizontal') {
              el.style.transform = `scaleX(${scrollPercentage})`;
            } else {
              el.style.transform = `scaleY(${scrollPercentage})`;
            }
            
            el.setAttribute('aria-valuenow', Math.round(scrollPercentage * 100).toString());
          });
        }
      });
    };

    window.addEventListener('scroll', calculateScrollProgress, { passive: true });
    calculateScrollProgress(); // Initial check
  }

  initScrollProgress();
  document.addEventListener('astro:page-load', initScrollProgress);
</script>